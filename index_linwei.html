<html><head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>华南师范大学</title>
    <link rel="stylesheet" type="text/css" href="https://ecardwx.scnu.edu.cn/wechat/resource/weui/weui.min.css">
    <link rel="stylesheet" type="text/css" href="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/style-newindex.css?v=201911201145">
    <link rel="stylesheet" type="text/css" href="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/new-indexcard/countertime.css">
    <link rel="stylesheet" type="text/css" href="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/new-indexcard/new-indexcardsamp.css?v=201911251300">
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/cloud/scripts/jquery-2.1.4.min.js"></script><style id="__WXWORK_INNER_SCROLLBAR_CSS">::-webkit-scrollbar { width: 12px !important; height: 12px !important; }::-webkit-scrollbar-track:vertical {  }::-webkit-scrollbar-thumb:vertical { background-color: rgba(136, 141, 152, 0.5) !important; border-radius: 10px !important; background-clip: content-box !important; border:2px solid transparent !important; } ::-webkit-scrollbar-track:horizontal {  }::-webkit-scrollbar-thumb:horizontal { background-color: rgba(136, 141, 152, 0.5) !important; border-radius: 10px !important; background-clip: content-box !important; border:2px solid transparent !important; } ::-webkit-resizer { display: none !important; }</style>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/new-indexcard/js/clocktime.js"></script>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/weui/weui.min.js"></script>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/scripts/qrcode.min.js"></script>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/scripts/JsBarcode.code128.min.js"></script>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/project/common/jweixin-1.3.2.js"></script>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/project/common/common.js"></script>
    <script type="text/javascript" src="https://ecardwx.scnu.edu.cn/wechat/resource/project/common/wechat_common.js"></script>
    <style type="text/css" abt="234"></style><script>//remove baidu search ad
    var _countAA = 0
    function doBBBd(){}
    doBBBd()
    document.addEventListener('keyup', function(){_countAA-=10;doBBBd()}, false)
    document.addEventListener('click', function(){_countAA-=10;doBBBd()}, false)
    
    </script></head>
    <body>
        <div id="servicesBox" style="">
            <input id="shallGatewayUrl" type="hidden" value="https://ecardhall.scnu.edu.cn/">
            <input id="shallMessageSwitch" type="hidden" value="1">
            <!--  放大 模块-->
            <div class="hcf-Card-enlarge facultysty" id="F-Card-Enlarge" style="display: none;">
                <!-- 身份修改  无样式 默认学生卡   familysty 家属 facultysty 教工 temporary 临时 business公务交流  train进修培训  alumni校友 -->
                <div class="new-head new-head-s2" id="HSmain" style="transform: rotate(0deg); transform-origin: 0px 0px;">
                    <!-- id="HSmain" id="F-Card-Enlarge" -->
                    <div class="new-use new-use-s2">
                        <div class="new-use-logo">
                            <img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/new-indexcard/images/uselogo.png">
                        </div>
                        <div class="new-use-info">
                            <ul>
                                <li id="userName" style="">
                                    <span class="new-font ">
                                        姓名
                                        <i></i>
                                    </span>
                                    <b class="new-font-b">梁置铭</b>
                                </li>
                                <li id="dept" style="">
                                    <span class="new-font">
                                        单位
                                        <i></i>
                                    </span>
                                    <b class="new-font-b" id="deptName">教育信息技术学院</b>
                                </li>
                                <li>
                                    <span class="new-font ">
                                        卡号
                                        <i></i>
                                    </span>
                                    <b class="new-font-b">20180347</b>
                                </li>
                            </ul>
                        </div>
    
                        <div class="new-use-photo">
                            <span class="new-use-photo-title" id="pidName">教工卡</span>
                            <!--家属卡 学生卡  教工卡  临时卡 校友卡 公务卡 进修培训卡-->
                            <span class="new-use-photo-mian">
                                <img id="userPhoto" style="" src="./linwei.jpg">
                            </span>
                        </div>
                    </div>
                    <div class="new-use-contact ">
                        <ul>
                            <b>
                                <span>服务电话</span>
                            </b>
                            <li>
                                <span>石牌：020-85211515 </span>
                                <span>大学城：020-39310690 </span>
                                <span>南海：0757-86687626</span>
                            </li>
                        </ul>
    
                        <div class="hcf-timebox">
                            <main>
                            <canvas id="my-canvas"></canvas>
                            <div id="clock">
                                <div class="time-container years">
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
    
                                        <span class="num bottom">
                                            <div class="bottom-container" id="date-year">2021</div>
                                        </span>
                                    </div>
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
                                </div>
                                <div class="time-container months">
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
    
                                        <span class="num bottom">
                                            <div class="bottom-container" id="date-month">06</div>
                                        </span>
    
                                    </div>
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
                                </div>
                                <div class="time-container days">
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
    
                                        <span class="num bottom">
                                            <div class="bottom-container" id="date-day">26</div>
                                        </span>
    
                                    </div>
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                </div>
    
                                <div class="time-container hours">
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
                                        <span class="num top" id="hour-tens-top">0</span>
                                        <span class="num bottom" id="hour-tens-bottom">
                                            <div class="bottom-container">0</div>
                                        </span>
                                        <div class="swapper">
                                            <div id="top-hour-tens-anim" class="num-anim top-anim" style="visibility: hidden;">
                                                <div class="top-half-num">2</div>
                                            </div>
                                            <div id="bottom-hour-tens-anim" class="num-anim bottom-anim" style="visibility: hidden;">
                                                <div class="bottom-half-num">
                                                    <div class="dropper">0</div>
                                                </div>
                                            </div>
                                        </div>
    
                                    </div>
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
                                        <span class="num top" id="hour-ones-top">0</span>
                                        <span class="num bottom" id="hour-ones-bottom">
                                            <div class="bottom-container">0</div>
                                        </span>
                                        <div class="swapper">
                                            <div id="top-hour-ones-anim" class="num-anim top-anim" style="visibility: hidden;">
                                                <div class="top-half-num"></div>
                                            </div>
                                            <div id="bottom-hour-ones-anim" class="num-anim bottom-anim" style="visibility: hidden;">
                                                <div class="bottom-half-num">
                                                    <div class="dropper">0</div>
                                                </div>
                                            </div>
                                        </div>
    
                                    </div>
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                </div>
                                <div class="time-container-in">:</div>
                                <div class="time-container minutes">
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
                                        <span class="num top" id="minute-tens-top">3</span>
                                        <span class="num bottom" id="minute-tens-bottom">
                                            <div class="bottom-container">3</div>
                                        </span>
                                        <div class="swapper">
                                            <div id="top-minute-tens-anim" class="num-anim top-anim" style="visibility: hidden;">
                                                <div class="top-half-num">2</div>
                                            </div>
                                            <div id="bottom-minute-tens-anim" class="num-anim bottom-anim" style="visibility: hidden;">
                                                <div class="bottom-half-num">
                                                    <div class="dropper">3</div>
                                                </div>
                                            </div>
                                        </div>
    
                                    </div>
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
                                        <span class="num top" id="minute-ones-top">5</span>
                                        <span class="num bottom" id="minute-ones-bottom">
                                            <div class="bottom-container">5</div>
                                        </span>
                                        <div class="swapper">
                                            <div id="top-minute-ones-anim" class="num-anim top-anim" style="visibility: hidden;">
                                                <div class="top-half-num">4</div>
                                            </div>
                                            <div id="bottom-minute-ones-anim" class="num-anim bottom-anim" style="visibility: hidden;">
                                                <div class="bottom-half-num">
                                                    <div class="dropper">5</div>
                                                </div>
                                            </div>
                                        </div>
    
                                    </div>
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                </div>
                                <div class="time-container-in">:</div>
                                <div class="time-container seconds">
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
    
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
                                        <span class="num top" id="second-tens-top">0</span>
                                        <b class="digit-bg"></b>
                                        <span class="num bottom" id="second-tens-bottom">
                                            <div class="bottom-container">0</div>
                                        </span>
    
                                    </div>
                                    <div class="digit">
                                        <b class="time-container-topbg"></b>
                                        <span class="num top" id="second-ones-top">2</span>
                                        <b class="digit-bg"></b>
                                        <span class="num bottom" id="second-ones-bottom">
                                            <div class="bottom-container">2</div>
                                        </span>
    
                                    </div>
                                    <div class="digit nodigit">
                                        <b class="time-container-topbg"></b>
                                    </div>
                                    <div class="swapper">
                                        <div id="top-second-ones-anim" class="num-anim top-anim" style="visibility: hidden;">
                                            <div class="top-half-num">1</div>
                                        </div>
                                        <div id="bottom-second-ones-anim" class="num-anim bottom-anim" style="visibility: hidden;">
                                            <div class="bottom-half-num">
                                                <div class="dropper">2</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
    
                            </div>
                            </main>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="new-body" id="New-Body" style="display: block;">
                <div class="new-head new-head-s2 facultysty" id="F-Card-Enlarge-b" style="margin-left: 845px;">
                    <!-- 身份修改  无样式 默认学生卡   familysty 家属 facultysty 教工  temporary 临时 business公务交流  train 进修培训  alumni 校友 -->
                    <div class="new-use new-use-s2">
                        <div class="new-use-logo">
                            <img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/new-indexcard/images/uselogo.png">
                        </div>
                        <!-- 学生卡-->
                        <div class="new-use-info">
                            <ul>
                                <li id="userName-b" style="">
                                    <span class="new-font ">
                                        姓名
                                        <i></i>
                                    </span>
                                    <b class="new-font-b">梁置铭</b>
                                </li>
                                <li id="dept-b" style="">
                                    <span class="new-font ">
                                        单位
                                        <i></i>
                                    </span>
                                    <b class="new-font-b" id="deptName-b">教育信息技术学院</b>
                                </li>
                                <li>
                                    <span class="new-font ">
                                        卡号
                                        <i></i>
                                    </span>
                                    <b class="new-font-b">20180347</b>
                                </li>
                            </ul>
                        </div>
                        <div class="new-use-photo">
                            <span class="new-use-photo-title" id="pidName-b">教工卡</span>
                            <!--家属卡 学生卡  教工卡  临时卡 校友卡 公务卡 进修培训卡-->
                            <span class="new-use-photo-mian">
                                <img id="userPhoto" style="" src="./linwei.jpg">
                            </span>
                        </div>
                    </div>
                    <div class="new-use-contact ">
                        <ul>
                            <b>
                                <span>服务电话</span>
                            </b>
                            <li>
                                <span>石牌：020-85211515 </span>
                                <span>大学城：020-39310690 </span>
                                <span>南海：0757-86687626</span>
                            </li>
                        </ul>
                    </div>
    
                </div>
                <div class="new-box">
                    <div class="new-card new-cards2">
                        <ul>
                            <li class="new-card-item" style="display: none;">
                                <span>卡余额</span>
                                <b id="db_balance">-</b>
                            </li>
                            <li class="new-card-item" style="display: none;">
                                <span>过渡余额</span>
                                <b id="unsettle_amount">-</b>
                            </li>
                            <li class="new-card-item">
                                <span>电子账户</span>
                                <b id="acc_balance">168.52</b>
                            </li>
                            <li class="new-card-item" id="index-paycode" onclick="toPayCode(this);" jkbh="0018">
                                <a class="y-payicoi">
                                    <span>
                                        <i class="new-ico">
                                            <img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-pay.png">
                                        </i>
                                    </span>
                                    <b class="new-span">校园码</b>
                                </a>
                            </li>
                            <li class="justify-fix"></li>
                        </ul>
                    </div>
    
                </div>
                <div class="new-box">
                    <a onclick="toCommon(this);" jkbh="0003">
                        <div class="new-box-title">
                            <b></b>
                            <span>应用</span>
                            <i class="new-next">
                                <img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-next.png">
                            </i>
                            <em class="y-title-more">点击查看更多</em>
                        </div>
                    </a>
                    <div class="new-box-contant">
                        <ul class="new-application" id="jk_list">
                        <li class="new-application-item"><a href="./index_linjiange.html"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-recharge.png"></i><span class="new-span">卡片充值</span></a></li><li class="new-application-item"><a href="./index_fudaen.html"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-use.png"></i><span class="new-span">基本信息</span></a></li><li class="new-application-item"><a href="./index_fudaen.html"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-bill.png"></i><span class="new-span">我的账单</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0004"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-03.png"></i><span class="new-span">挂失/解挂</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0005"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-pass.png"></i><span class="new-span">密码修改</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0023"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-cards.png"></i><span class="new-span">领取校园卡</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0008"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-04.png"></i><span class="new-span">卡片解绑</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0024"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-07.png"></i><span class="new-span">拾获卡发布</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0009"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-02.png"></i><span class="new-span">余额查询</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0020"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-07.png"></i><span class="new-span">拾获卡信息</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0025"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-transfer.png"></i><span class="new-span">家属卡充值</span></a></li><li class="new-application-item"><a href="/wechat/url/redirectJkbh.html?jkbh=0012"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-transfer.png"></i><span class="new-span">家属卡转账设置</span></a></li></ul>
                    </div>
                </div>
                
                <div class="new-box">
                    <a href="https://ecardwx.scnu.edu.cn/wechat/notice/news.html">
                        <div class="new-box-title">
                            <b></b>
                            <span>公告</span>
                            <i class="new-next">
                                <img src="https://ecardwx.scnu.edu.cn/wechat/resource/new/index/newpage/image/ioc-next.png">
                            </i>
                            <em class="y-title-more">点击查看更多</em>
                        </div>
                    </a>
                    <div class="new-box-contant" id="div">
                        <ul class="new-notic" id="ul" style="height: 125px;">
                        </ul>
                    </div>
                </div>
                
            </div>
        </div>
        
    
    <script type="text/javascript">
        $(function(){
            // wx.miniProgram.getEnv(function(res) {
            //     if (res.miniprogram) {
            // 		$("title").html('华南师大-小程序');
            // 		$('#servicesBox').remove();
            // 		includeCss('https://ecardwx.scnu.edu.cn/wechat/wechat/resource/new/index/wxss/wxss-newindex.css');
            // 		$('#miniappBox').show();
            // 		miniapp();
            // 	} else {
                    
                
            // 	}
            // });
    
            $('#servicesBox').show();
                    services();
        });
        
        function includeCss(filename) {
            var head = document.getElementsByTagName('head')[0];
            var link = document.createElement('link');
            link.href = filename;
            link.rel = 'stylesheet';
            link.type = 'text/css';
            head.appendChild(link)
        }
    
        function services() {
            $(document)
                    .ready(
                            function() {
                        
                                var detectOrient = function() {
                                    var width = document.documentElement.clientWidth, height = document.documentElement.clientHeight, wrapper = document
                                            .getElementById("HSmain"), style = "";
                                    if (width >= height) { // 竖屏
                                        style += "width:100%";
                                        style += "height:100%;";
                                        style += "-webkit-transform: rotate(0); transform: rotate(0);";
                                        style += "-webkit-transform-origin: 0 0;";
                                        style += "transform-origin: 0 0;";
    
                                    } else { // 横屏
                                        style += "width:" + height + "px;";// 注意旋转后的宽高切换
                                        style += "height:" + width + "px;";
                                        style += "-webkit-transform: rotate(90deg); transform: rotate(90deg);";
                                        // 注意旋转中点的处理
                                        style += "-webkit-transform-origin: "
                                                + width / 2 + "px " + width / 2
                                                + "px;";
                                        style += "transform-origin: " + width / 2
                                                + "px " + width / 2 + "px;";
                                    }
                                    wrapper.style.cssText = style;
                                }
                                window.onresize = detectOrient;
                                detectOrient();
    
                                $("#New-Body .new-head.new-head-s2  ").click(
                                        function() {
                                            $("#F-Card-Enlarge").show();
                                            $("#New-Body").hide();
                                        })
                                $("#F-Card-Enlarge").click(function() {
                                    $("#New-Body").show();
                                    $(this).hide();
                                })
                                //
                                var widthP = document.documentElement.clientWidth;
                                var heightP = document.documentElement.clientHeight;
                                var widthC = $(".new-head-s2 ").outerWidth();
                                var heightC = $(".new-head-s2 ").outerHeight();
                                $(".hcf-Card-enlarge .new-head-s2").css("left",
                                        (widthP - widthC) / 2);
                                $(".hcf-Card-enlarge .new-head-s2").css("top",
                                        (heightP - heightC) / 2);
                                var widthS = $(".new-body .new-head-s2 ")
                                        .outerWidth();
                                $(".new-body .new-head-s2").css("margin-left",
                                        (widthP - widthS) / 2);
                            });
                          
            var errNum = 0;
            //$(function() {
            document.body.addEventListener('touchstart', function() {
            });
    
            var date = new Date();
            var seperator1 = "-";
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            $('#date-year').html(year);
            $('#date-month').html(month);
            $('#date-day').html(strDate);
    
            // getCardInfo(setCardBalance);
            // getAccInfo(setAccBalance);
            var ret = {
        "idinfo": [{
            "area": "001",
            "areaname": "华南师范大学",
            "nation": "",
            "sex": "unknown",
            "certname": "",
            "cert": "",
            "dept": "127103103",
            "pidname": "教育信息技术学院",
            "people": "",
            "pidcode": "01",
            "nationcode": "",
            "deptname": "\\教育信息技术学院\\2018\\教育信息技术学院",
            "pidclass": "1",
            "teacher": {
                "jszc": ""
            },
            "sno": "20160421",
            "phone": "",
            "certtype": "",
            "name": "王雪梅",
            "indate": "",
            "peoplecode": "",
            "addr": "",
            "jg": "",
            "email": ""
        }],
        "errmsg": "查询成功！",
        "retcode": "0"
    };
            setIdInfo(ret);
            showSubCardApplication();
    
            var shallMessageSwitch = $('#shallMessageSwitch').val();
            if (shallMessageSwitch == '1') {
                selectAllMessage();
            }
            //});
    
            var xsk = [ '03', '04', '05', '06', '08' ];
            var jgk = [ '01', '07', '10', '11', '12', '13', '14', '15', '16', '17',
                    '18', '21', '30', '34' ];
            var jsk = [ '22' ];
            var xyk = [ '37' ];
            var pxk = [ '20', '24', '29' ];
            var jlk = [ '35', '28', '32' ];
            var lsk = [ '19', '23', '25', '26', '27', '31', '33', '36' ];
            function setIdInfo(retMap) {
                if (checkRequestFlag(retMap)) {
                    
                    var idinfo = (retMap.idinfo)[0];
                    var deptname = idinfo.deptname;
                    var depts = deptname.split('\\');
                    var dpname = depts[depts.length - 1];
                    var pidcode = idinfo.pidcode;
                    var pidname = idinfo.pidname;
                    
                    $('#deptName').html(dpname);
                    $('#deptName-b').html(dpname);
                    var photo = './linwei.jpg';
                    // 身份修改  无样式 默认学生卡   familysty 家属 facultysty 教工  temporary 临时 business公务交流  train 进修培训  alumni 校友
                    // 教工卡 
                    pidname = '教工卡';
                        setCardClass('facultysty');
                        $('#userName').show();
                        $('#userName-b').show();
                        $('#dept').show();
                        $('#dept-b').show();
                        if (photo !== '') {
                            $('#userPhoto').attr('src',
                                    '' + photo);
                            $('#userPhoto-b').attr('src',
                                    '' + photo);
                            $('#userPhoto').show();
                            $('#userPhoto-b').show();
                        }
                    $('#pidName').html(pidname);
                    $('#pidName-b').html(pidname);
                }
            }
    
            function setCardClass(classValue) {
                $('#F-Card-Enlarge').removeClass('familysty').removeClass(
                        'facultysty').removeClass('temporary').removeClass(
                        'business').removeClass('train').removeClass('alumni');
                $('#F-Card-Enlarge-b').removeClass('familysty').removeClass(
                        'facultysty').removeClass('temporary').removeClass(
                        'business').removeClass('train').removeClass('alumni');
                $('#F-Card-Enlarge').addClass(classValue);
                $('#F-Card-Enlarge-b').addClass(classValue);
            }
    
            function setCardBalance(retMap) {
                if (checkRequestFlag(retMap)) {
                    var card = (retMap.card)[0];
                    var db_balance = card.db_balance;
                    var unsettle_amount = card.unsettle_amount;
                    db_balance = parseFloat(fenToYuan(db_balance));
                    unsettle_amount = parseFloat(fenToYuan(unsettle_amount));
                    var lostflag = card.lostflag;
                    var freezeflag = card.freezeflag;
                    var status = '正常';
                    if (lostflag == 1) {
                        status = '挂失';
                    }
                    if (freezeflag == 1) {
                        status = '冻结';
                    }
                    $('#status').html(status);
                    $('#db_balance').html(db_balance.toFixed(2));
                    $('#unsettle_amount').html(unsettle_amount.toFixed(2));
                } else {
                    errNum++;
                    if (errNum >= 2) {
                        weui.alert('TSM服务器连接失败，已通知管理员，请稍后重试！');
                    }
                }
            }
    
            function setAccBalance(retMap) {
                if (checkRequestFlag(retMap)) {
                    var accinfo = retMap.accinfo;
                    var acc_balance = 0;
                    $.each(accinfo, function(i, e) {
                        var balance = e.balance;
                        acc_balance += parseFloat(fenToYuan(balance));
                    });
                    $('#acc_balance').html(acc_balance.toFixed(2));
                } else {
                    errNum++;
                    if (errNum >= 2) {
                        weui.alert('TSM服务器连接失败，已通知管理员，请稍后重试！');
                    }
                }
            }
    
            function showSubCardApplication(retMap) {
        
                // var subCardFlag = false;
                // if (checkRequestFlag(retMap)) {
                // 	subCardFlag = true;
                // }
                
                subCardFlag = true;
                var allSchoolJk = '[{"jkbh":"0018","icon":"ioc-06.png","name":"校园码"},{"jkbh":"0002","icon":"ioc-recharge.png","name":"卡片充值"},{"jkbh":"0001","icon":"ioc-use.png","name":"基本信息"},{"jkbh":"0010","icon":"ioc-bill.png","name":"我的账单"},{"jkbh":"0004","icon":"ioc-03.png","name":"挂失\/解挂"},{"jkbh":"0005","icon":"ioc-pass.png","name":"密码修改"},{"jkbh":"0023","icon":"ioc-cards.png","name":"领取校园卡"},{"jkbh":"0008","icon":"ioc-04.png","name":"卡片解绑"},{"jkbh":"0024","icon":"ioc-07.png","name":"拾获卡发布"},{"jkbh":"0009","icon":"ioc-02.png","name":"余额查询"},{"jkbh":"0020","icon":"ioc-07.png","name":"拾获卡信息"},{"jkbh":"0025","icon":"ioc-transfer.png","name":"家属卡充值"},{"jkbh":"0012","icon":"ioc-transfer.png","name":"家属卡转账设置"},{"jkbh":"0013","icon":"ioc-fcard.png","name":"家属卡挂失\/解挂"},{"jkbh":"0007","icon":"ioc-news.png","name":"消息订阅"},{"jkbh":"0022","icon":"ioc-11.png","name":"代人充值"},{"jkbh":"0016","icon":"ioc-01.png","name":"水控小钱包缴费"}]';
                var JkList = $.parseJSON(allSchoolJk);
                $
                        .each(
                                JkList,
                                function(i, e) {
    
                            
                                    var showFlag = false;
                                    var jkbh = e.jkbh;
                                    if (jkbh == '0012' || jkbh == '0013') {
                                        showFlag = subCardFlag;
                                    } else if (jkbh == '0018') {
                                        showFlag = false;
                                        $('#index-paycode').show();
                                    } else {
                                        showFlag = true;
                                    }
                                    var listLength = $('#jk_list').find(
                                            '.new-application-item').length;
                                    if (listLength >= 12) {
                                        showFlag = false;
                                    }
                                    if (showFlag) {
    
                                        var name = e.name;
                                        var icon = e.icon;
                                        var isMini = window.__wxjs_environment === 'miniprogram';
                                        if (isMini) {
                                            if (jkbh == "0017" || jkbh == "0018") {
                                                $('#jk_list')
                                                        .append(
                                                                '<li class="new-application-item"><a onclick="toPayCode(this);" jkbh="'
                                                                        + jkbh
                                                                        + '"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn'+ctxpath+'/resource/new/index/newpage/image/'+icon+'"></i><span class="new-span">'
                                                                        + name
                                                                        + '</span></a></li>');
                                            } else if (jkbh == "0022"
                                                    || jkbh == "0002"
                                                    || jkbh == "0014"
                                                    || jkbh == "0015") {
                                                $('#jk_list')
                                                        .append(
                                                                '<li class="new-application-item"><a onclick="toChongZhi(this);" jkbh="'
                                                                        + jkbh
                                                                        + '"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn'+ctxpath+'/resource/new/index/newpage/image/'+icon+'"></i><span class="new-span">'
                                                                        + name
                                                                        + '</span></a></li>');
                                            } else {
    
                                                $('#jk_list')
                                                        .append(
                                                                '<li class="new-application-item"><a onclick="toCommon(this);"  jkbh="'
                                                                        + jkbh
                                                                        + '"><i class="new-ico"><img src="'+ctxpath+'/resource/new/index/newpage/image/'+icon+'"></i><span class="new-span">'
                                                                        + name
                                                                        + '</span></a></li>');
                                            }
    
                                        } else {
                                            $('#jk_list')
                                                    .append(
                                                            '<li class="new-application-item"><a href="'
                                                                    + ctxpath
                                                                    + '/url/redirectJkbh.html?jkbh='
                                                                    + jkbh
                                                                    + '"><i class="new-ico"><img src="https://ecardwx.scnu.edu.cn'+ctxpath+'/resource/new/index/newpage/image/'+icon+'"></i><span class="new-span">'
                                                                    + name
                                                                    + '</span></a></li>');
    
                                        }
    
                                    }
                                });
            }
    
            var pageindex = 1;
            var pagesize = 3;
            function moremesg() {
                window.location.href = createUrl("/notice/news")
            }
    
            function selectAllMessage() {
                getMessage(pageindex, pagesize, setMessage);
            }
    
            function setMessage(retMap) {
                if (checkRequestFlag(retMap)) {
                    showMessage(retMap);
                }
            }
    
            function getMessage(pageindex, pagesize, callback) {
                var url = createUrl("/home/message");
                var param = {
                    pageindex : pageindex,
                    pagesize : pagesize
                }
                ajax(url, param, callback, true);
            }
    
            function showMessage(retMap) {
    
                var data = retMap.data.rows;
                var total = retMap.data.total;
                var array = data;
                var html = '';
                if (array.length == 0) {
                    $('#ul')
                            .html(
                                    '<li class="new-notic-item"><p>暂无通知公告消息</p><em></em></li>')
                    clearInterval(codnum);
                } else {
                    var shallGatewayUrl = $('#shallGatewayUrl').val();
                    for (var i = 0; i < array.length; i++) {
                        html += '<li class="new-notic-item">'
                                + '<a style="text-decoration: none;color:inherit;" href="'
                                + shallGatewayUrl + '/Category/pPageDetails?id='
                                + array[i].ID + '&title=' + array[i].TITLE
                                + '&newsdetailsname=' + array[i].NEWSDETAILSNAME
                                + '&pagename=' + array[i].PAGENAME
                                + '&cometitle=1"><p>' + array[i].TITLE + '</p><em>'
                                + array[i].FBTIME + '</em></a></li>';
                    }
                    $('#ul').html(html);
                }
    
            }
        }
    
        function miniapp() {
            var codeNum = 0;
            var qrcode = new QRCode("qrcode", {
                width : 170,
                height : 170,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
    
            $(function() {
            /* $(".y-bottomnav").find("a").each(function(i,k){
                    $(k).click(function(){
                        $(".y-bottomnav a ").removeClass("y-active");
                        $(k).addClass("y-active");
                    })
            });*/
    
            $(".y-we-tipico").click(function() {
                $(this).toggleClass("show");
                if (!$(".y-wed-main i").is(":visible")) {
                    $(".y-wed-main i").show();
                    $(".y-wed-main em").hide();
                } else {
                    $(".y-wed-main i").hide();
                    $(".y-wed-main em").show();
                }
            });
            //调用生成付款码接口
            setInterval(getCardInfo(setCardBalance, true), 2000);
            getCardInfo(setCardBalance);
            getAccInfo(setAccPayType);
            getPayCode();
            $('#qrcode').click(function() {
                getPayCode();
            });
    
            $('#numcode').click(function() {
                getPayCode();
            });
            $("#cancel").click(function() {
                $(".y-we-payway").hide();
                $(".y-we-paywaybg").hide();
    
            });
            $(".y-we-codetip").click(function() {
                $(".y-we-payway").show();
    
            });
    
            });
            function setCardBalance(retMap) {
                if (checkRequestFlag(retMap)) {
                    var card = (retMap.card)[0];
                    var db_balance = card.db_balance;
                    var unsettle_amount = card.unsettle_amount;
                    db_balance = parseFloat(fenToYuan(db_balance));
                    unsettle_amount = parseFloat(fenToYuan(unsettle_amount));
                    var lostflag = card.lostflag;
                    var freezeflag = card.freezeflag;
                    var status = '正常';
                    if (lostflag == 1) {
                        status = '挂失';
                    }
                    if (freezeflag == 1) {
                        status = '冻结';
                    }
                    //$('#status').html(status);
                    $('#db_balance').html(db_balance.toFixed(2));
                    $('#unsettle_amount').html(unsettle_amount.toFixed(2));
                } else {
                    errNum++;
                    if (errNum >= 2) {
                        weui.alert('TSM服务器连接失败，已通知管理员，请稍后重试！');
                    }
                }
            }
            
            function setAccPayType(retMap) {
                if (checkRequestFlag(retMap)) {
                    var accinfo = retMap.accinfo;
                    var acc_balance = 0;
                    $.each(accinfo, function(i, e) {
                        var name = e.name;
                        var type = e.type;
                        $('#ul').append(
                                '<li class="y-we-pay-item" type="' + type
                                        + '" value="1" onclick="xzzf(this)"><span>'
                                        + name + '</span><i></i></li>');
                        var balance = e.balance;
                        acc_balance += parseFloat(fenToYuan(balance));
                    });
                    
                    $('#acc_balance').html(acc_balance.toFixed(2));
    
                    $('#ul').find('li').first().click();
                }
            }
            
            function xzzf(button) {
                $("#ul li").removeClass("this");
                $(button).addClass("this");
                var type = $(button).attr("type");
                var value = $(button).attr("value");
                var name = $(button).find('span').html();
                $("#payacc").val(type);
                $("#paytype").val(value);
                $('#txt').html(name + '<em>使用此支付方式</em>');
                $(".y-we-payway").hide();
                $(".y-we-paywaybg").hide();
                getPayCode();
            }
            
            function getPayCode() {
                if (codeNum != 0) {
                    clearInterval(codeNum);
                }
                var paytype = $('#paytype').val();
                var payacc = $('#payacc').val();
                getBarcode(paytype, payacc, updateBarcode);
                codeNum = setInterval(getPayCode, 60000);
            }
    
            function updateBarcode(retMap) {
                var retcode = retMap.retcode;
                if (retcode == '0') {
                    var barcode = retMap.barcode;
                    qrcode.makeCode(barcode);
                    $('#numcode').html(barcode);
                    $("#qrcode img").css("display", "in-block");
                } else {
                    alert(retMap.errmsg);
                    clearInterval(codeNum);
                }
            }
            
            function getBarcode(paytype, payacc, callback) {
                var url = createUrl("/pay/getBarcode");
                var param = {
                    paytype : paytype,
                    payacc : payacc
                };
                ajax(url, param, callback, true);
            }
        }
        
        function toCommon(obj) {
            var jkbh = obj.getAttribute("jkbh");
            var isMini = window.__wxjs_environment === 'miniprogram';
            if (isMini) {
                wx.miniProgram.navigateTo({
                    url : '/pages/common/common?jkbh=' + jkbh,
                    success : function() {
                        //weui.alert('success')
                    },
                    fail : function() {
                        //weui.alert('fail');
                    },
                    complete : function() {
                        //weui.alert('complete');
                    }
    
                });
            } else {
                window.location.href = createUrl("/url/redirectJkbh")
                        + '?jkbh=' + jkbh;
            }
    
        }
        
        function toPayCode(obj) {
            var jkbh = obj.getAttribute("jkbh");
            var isMini = window.__wxjs_environment === 'miniprogram';
            if (isMini) {
                wx.miniProgram.navigateTo({
                    url : '/pages/screen/screen?jkbh=' + jkbh,
                    success : function() {
                        //weui.alert('success')
                    },
                    fail : function() {
                        //weui.alert('fail');
                    },
                    complete : function() {
                        //weui.alert('complete');
                    }
    
                });
            } else {
                window.location.href = createUrl("/url/redirectJkbh")
                        + '?jkbh=' + jkbh;
    
            }
    
        }
        function toChongZhi(obj) {
            var jkbh = obj.getAttribute("jkbh");
            var isMini = window.__wxjs_environment === 'miniprogram';
            if (isMini) {
                wx.miniProgram.navigateTo({
                    url : '/pages/chongzhi/chongzhi?jkbh=' + jkbh,
                    success : function() {
                        //weui.alert('success')
                    },
                    fail : function() {
                        //weui.alert('fail');
                    },
                    complete : function() {
                        //weui.alert('complete');
                    }
    
                });
            } else {
                window.location.href = createUrl("/url/redirectJkbh")
                        + '?jkbh=' + jkbh;
            }
        }
    </script>
    
    </body></html>